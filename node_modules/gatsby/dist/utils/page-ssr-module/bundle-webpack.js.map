{"version":3,"file":"bundle-webpack.js","names":["extensions","outputDir","path","join","process","cwd","cacheLocation","copyStaticQueriesToEngine","engineTemplatePaths","components","staticQueriesByTemplate","staticQueriesToCopy","Set","component","values","isSlice","has","componentPath","staticQueryHashes","get","hash","add","sourceDir","destDir","fs","ensureDir","emptyDir","promisesToAwait","sourcePath","destPath","push","copy","Promise","all","createPageSSRBundle","rootDir","webpackCompilationHash","reporter","isVerbose","state","store","getState","pathPrefix","program","prefixPaths","config","slicesStateObject","key","value","slices","slicesByTemplateStateObject","template","records","slicesByTemplate","recordsObject","Object","keys","webpackStats","readWebpackStats","toInline","pageTemplate","componentChunkName","query","assets","getScriptsAndStylesForTemplate","pagesIterable","pagePath","page","pages","mode","getPageMode","context","matchPath","compiler","webpack","name","entry","__dirname","output","filename","libraryTarget","target","externalsPresets","node","cache","type","buildDependencies","__filename","externals","mod","builtinModules","reduce","acc","builtinModule","devtool","module","rules","test","resolve","byDependency","esm","fullySpecified","parser","amd","use","loader","require","options","outputAssetBase","alias","inquirer","plugins","DefinePlugin","INLINED_TEMPLATE_TO_DETAILS","JSON","stringify","INLINED_HEADERS_CONFIG","headers","WEBPACK_COMPILATION_HASH","GATSBY_PAGES","GATSBY_SLICES","GATSBY_SLICES_BY_TEMPLATE","GATSBY_SLICES_SCRIPT","env","readFileSync","PATH_PREFIX","GATSBY_WEBPACK_LOGGING","includes","WebpackLoggingPlugin","filter","Boolean","IMAGE_CDN_URL_GENERATOR_MODULE_RELATIVE_PATH","global","__GATSBY","imageCDNUrlGeneratorModulePath","copyFile","FILE_CDN_URL_GENERATOR_MODULE_RELATIVE_PATH","fileCDNUrlGeneratorModulePath","functionCode","readFile","replaceAll","shouldBundleDatastore","getLmdbOnCdnPath","adapter","deployURL","outputFile","reject","run","err","stats","close","closeErr","compilation"],"sources":["../../../src/utils/page-ssr-module/bundle-webpack.ts"],"sourcesContent":["import * as path from \"path\"\nimport * as fs from \"fs-extra\"\nimport webpack from \"webpack\"\nimport mod from \"module\"\nimport { WebpackLoggingPlugin } from \"../../utils/webpack/plugins/webpack-logging\"\nimport reporter from \"gatsby-cli/lib/reporter\"\nimport type { EnginePage, ITemplateDetails } from \"./entry\"\n\nimport {\n  getScriptsAndStylesForTemplate,\n  readWebpackStats,\n} from \"../client-assets-for-template\"\nimport { IGatsbyState } from \"../../redux/types\"\nimport { store } from \"../../redux\"\nimport { getLmdbOnCdnPath, shouldBundleDatastore } from \"../engines-helpers\"\nimport { getPageMode } from \"../page-mode\"\n\ntype Reporter = typeof reporter\n\nconst extensions = [`.mjs`, `.js`, `.json`, `.node`, `.ts`, `.tsx`]\nconst outputDir = path.join(process.cwd(), `.cache`, `page-ssr`)\nconst cacheLocation = path.join(process.cwd(), `.cache`, `webpack`, `page-ssr`)\n\nexport async function copyStaticQueriesToEngine({\n  engineTemplatePaths,\n  components,\n  staticQueriesByTemplate,\n}: {\n  engineTemplatePaths: Set<string>\n  components: IGatsbyState[\"components\"]\n  staticQueriesByTemplate: IGatsbyState[\"staticQueriesByTemplate\"]\n}): Promise<void> {\n  const staticQueriesToCopy = new Set<string>()\n\n  for (const component of components.values()) {\n    // figuring out needed slices for each pages using componentPath is not straightforward\n    // so for now we just collect static queries for all slices + engine templates\n    if (component.isSlice || engineTemplatePaths.has(component.componentPath)) {\n      const staticQueryHashes =\n        staticQueriesByTemplate.get(component.componentPath) || []\n\n      for (const hash of staticQueryHashes) {\n        staticQueriesToCopy.add(hash)\n      }\n    }\n  }\n\n  const sourceDir = path.join(process.cwd(), `public`, `page-data`, `sq`, `d`)\n  const destDir = path.join(outputDir, `sq`)\n\n  await fs.ensureDir(destDir)\n  await fs.emptyDir(destDir)\n\n  const promisesToAwait: Array<Promise<void>> = []\n  for (const hash of staticQueriesToCopy) {\n    const sourcePath = path.join(sourceDir, `${hash}.json`)\n    const destPath = path.join(destDir, `${hash}.json`)\n\n    promisesToAwait.push(fs.copy(sourcePath, destPath))\n  }\n\n  await Promise.all(promisesToAwait)\n}\n\nexport async function createPageSSRBundle({\n  rootDir,\n  components,\n  staticQueriesByTemplate,\n  webpackCompilationHash,\n  reporter,\n  isVerbose = false,\n}: {\n  rootDir: string\n  components: IGatsbyState[\"components\"]\n  staticQueriesByTemplate: IGatsbyState[\"staticQueriesByTemplate\"]\n  webpackCompilationHash: IGatsbyState[\"webpackCompilationHash\"]\n  reporter: Reporter\n  isVerbose?: boolean\n}): Promise<webpack.Compilation | undefined> {\n  const state = store.getState()\n  const pathPrefix = state.program.prefixPaths\n    ? state.config.pathPrefix ?? ``\n    : ``\n  const slicesStateObject = {}\n  for (const [key, value] of state.slices) {\n    slicesStateObject[key] = value\n  }\n\n  const slicesByTemplateStateObject = {}\n  for (const [template, records] of state.slicesByTemplate) {\n    const recordsObject = {}\n    for (const path of Object.keys(records)) {\n      recordsObject[path] = records[path]\n    }\n\n    slicesByTemplateStateObject[template] = recordsObject\n  }\n\n  const webpackStats = await readWebpackStats(path.join(rootDir, `public`))\n\n  const toInline: Record<string, ITemplateDetails> = {}\n  for (const pageTemplate of components.values()) {\n    const staticQueryHashes =\n      staticQueriesByTemplate.get(pageTemplate.componentPath) || []\n\n    toInline[pageTemplate.componentChunkName] = {\n      query: pageTemplate.query,\n      staticQueryHashes,\n      assets: await getScriptsAndStylesForTemplate(\n        pageTemplate.componentChunkName,\n        webpackStats\n      ),\n    }\n  }\n\n  const pagesIterable: Array<[string, EnginePage]> = []\n  for (const [pagePath, page] of state.pages) {\n    const mode = getPageMode(page, state)\n    if (mode !== `SSG`) {\n      pagesIterable.push([\n        pagePath,\n        {\n          componentChunkName: page.componentChunkName,\n          componentPath: page.componentPath,\n          context: page.context,\n          matchPath: page.matchPath,\n          mode,\n          path: page.path,\n          slices: page.slices,\n        },\n      ])\n    }\n  }\n\n  const compiler = webpack({\n    name: `Page Engine`,\n    mode: `none`,\n    entry: path.join(__dirname, `entry.js`),\n    output: {\n      path: outputDir,\n      filename: `index.js`,\n      libraryTarget: `commonjs`,\n    },\n    target: `node`,\n    externalsPresets: {\n      node: false,\n    },\n    cache: {\n      type: `filesystem`,\n      name: `page-ssr`,\n      cacheLocation,\n      buildDependencies: {\n        config: [__filename],\n      },\n    },\n    // those are required in some runtime paths, but we don't need them\n    externals: [\n      /^\\.\\/routes/,\n      `electron`, // :shrug: `got` seems to have electron specific code path\n      mod.builtinModules.reduce((acc, builtinModule) => {\n        if (builtinModule === `fs`) {\n          acc[builtinModule] = `global _actualFsWrapper`\n        } else {\n          acc[builtinModule] = `commonjs ${builtinModule}`\n        }\n\n        return acc\n      }, {}),\n    ],\n    devtool: false,\n    module: {\n      rules: [\n        {\n          test: /\\.m?js$/,\n          type: `javascript/auto`,\n          resolve: {\n            byDependency: {\n              esm: {\n                fullySpecified: false,\n              },\n            },\n          },\n        },\n        {\n          // For node binary relocations, include \".node\" files as well here\n          test: /\\.(m?js|node)$/,\n          // it is recommended for Node builds to turn off AMD support\n          parser: { amd: false },\n          use: {\n            loader: require.resolve(`@vercel/webpack-asset-relocator-loader`),\n            options: {\n              outputAssetBase: `assets`,\n            },\n          },\n        },\n        {\n          test: /\\.txt/,\n          type: `asset/resource`,\n        },\n      ],\n    },\n    resolve: {\n      extensions,\n      alias: {\n        \".cache\": `${rootDir}/.cache/`,\n        [require.resolve(`gatsby-cli/lib/reporter/loggers/ink/index.js`)]:\n          false,\n        inquirer: false,\n      },\n    },\n    plugins: [\n      new webpack.DefinePlugin({\n        INLINED_TEMPLATE_TO_DETAILS: JSON.stringify(toInline),\n        INLINED_HEADERS_CONFIG: JSON.stringify(state.config.headers),\n        WEBPACK_COMPILATION_HASH: JSON.stringify(webpackCompilationHash),\n        GATSBY_PAGES: JSON.stringify(pagesIterable),\n        GATSBY_SLICES: JSON.stringify(slicesStateObject),\n        GATSBY_SLICES_BY_TEMPLATE: JSON.stringify(slicesByTemplateStateObject),\n        GATSBY_SLICES_SCRIPT: JSON.stringify(\n          _CFLAGS_.GATSBY_MAJOR === `5` && process.env.GATSBY_SLICES\n            ? fs.readFileSync(\n                path.join(\n                  rootDir,\n                  `public`,\n                  `_gatsby`,\n                  `slices`,\n                  `_gatsby-scripts-1.html`\n                ),\n                `utf-8`\n              )\n            : ``\n        ),\n        PATH_PREFIX: JSON.stringify(pathPrefix),\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        \"process.env.GATSBY_LOGGER\": JSON.stringify(`yurnalist`),\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        \"process.env.GATSBY_SLICES\": JSON.stringify(\n          !!process.env.GATSBY_SLICES\n        ),\n      }),\n      process.env.GATSBY_WEBPACK_LOGGING?.includes(`page-engine`)\n        ? new WebpackLoggingPlugin(rootDir, reporter, isVerbose)\n        : false,\n    ].filter(Boolean) as Array<webpack.WebpackPluginInstance>,\n  })\n\n  let IMAGE_CDN_URL_GENERATOR_MODULE_RELATIVE_PATH = ``\n  if (global.__GATSBY?.imageCDNUrlGeneratorModulePath) {\n    await fs.copyFile(\n      global.__GATSBY.imageCDNUrlGeneratorModulePath,\n      path.join(outputDir, `image-cdn-url-generator.js`)\n    )\n    IMAGE_CDN_URL_GENERATOR_MODULE_RELATIVE_PATH = `./image-cdn-url-generator.js`\n  }\n\n  let FILE_CDN_URL_GENERATOR_MODULE_RELATIVE_PATH = ``\n  if (global.__GATSBY?.fileCDNUrlGeneratorModulePath) {\n    await fs.copyFile(\n      global.__GATSBY.fileCDNUrlGeneratorModulePath,\n      path.join(outputDir, `file-cdn-url-generator.js`)\n    )\n    FILE_CDN_URL_GENERATOR_MODULE_RELATIVE_PATH = `./file-cdn-url-generator.js`\n  }\n\n  let functionCode = await fs.readFile(\n    path.join(__dirname, `lambda.js`),\n    `utf-8`\n  )\n\n  functionCode = functionCode\n    .replaceAll(\n      `%CDN_DATASTORE_PATH%`,\n      shouldBundleDatastore() ? `` : getLmdbOnCdnPath()\n    )\n    .replaceAll(\n      `%CDN_DATASTORE_ORIGIN%`,\n      shouldBundleDatastore() ? `` : state.adapter.config.deployURL ?? ``\n    )\n    .replaceAll(`%PATH_PREFIX%`, pathPrefix)\n    .replaceAll(\n      `%IMAGE_CDN_URL_GENERATOR_MODULE_RELATIVE_PATH%`,\n      IMAGE_CDN_URL_GENERATOR_MODULE_RELATIVE_PATH\n    )\n    .replaceAll(\n      `%FILE_CDN_URL_GENERATOR_MODULE_RELATIVE_PATH%`,\n      FILE_CDN_URL_GENERATOR_MODULE_RELATIVE_PATH\n    )\n\n  await fs.outputFile(path.join(outputDir, `lambda.js`), functionCode)\n\n  return new Promise((resolve, reject) => {\n    compiler.run((err, stats) => {\n      compiler.close(closeErr => {\n        if (err) {\n          return reject(err)\n        }\n        if (closeErr) {\n          return reject(closeErr)\n        }\n        return resolve(stats?.compilation)\n      })\n    })\n  })\n}\n"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AAIA;AAKA;AACA;AACA;AAA0C;AAAA;AAI1C,MAAMA,UAAU,GAAG,CAAE,MAAK,EAAG,KAAI,EAAG,OAAM,EAAG,OAAM,EAAG,KAAI,EAAG,MAAK,CAAC;AACnE,MAAMC,SAAS,GAAGC,IAAI,CAACC,IAAI,CAACC,OAAO,CAACC,GAAG,EAAE,EAAG,QAAO,EAAG,UAAS,CAAC;AAChE,MAAMC,aAAa,GAAGJ,IAAI,CAACC,IAAI,CAACC,OAAO,CAACC,GAAG,EAAE,EAAG,QAAO,EAAG,SAAQ,EAAG,UAAS,CAAC;AAExE,eAAeE,yBAAyB,CAAC;EAC9CC,mBAAmB;EACnBC,UAAU;EACVC;AAKF,CAAC,EAAiB;EAChB,MAAMC,mBAAmB,GAAG,IAAIC,GAAG,EAAU;EAE7C,KAAK,MAAMC,SAAS,IAAIJ,UAAU,CAACK,MAAM,EAAE,EAAE;IAC3C;IACA;IACA,IAAID,SAAS,CAACE,OAAO,IAAIP,mBAAmB,CAACQ,GAAG,CAACH,SAAS,CAACI,aAAa,CAAC,EAAE;MACzE,MAAMC,iBAAiB,GACrBR,uBAAuB,CAACS,GAAG,CAACN,SAAS,CAACI,aAAa,CAAC,IAAI,EAAE;MAE5D,KAAK,MAAMG,IAAI,IAAIF,iBAAiB,EAAE;QACpCP,mBAAmB,CAACU,GAAG,CAACD,IAAI,CAAC;MAC/B;IACF;EACF;EAEA,MAAME,SAAS,GAAGpB,IAAI,CAACC,IAAI,CAACC,OAAO,CAACC,GAAG,EAAE,EAAG,QAAO,EAAG,WAAU,EAAG,IAAG,EAAG,GAAE,CAAC;EAC5E,MAAMkB,OAAO,GAAGrB,IAAI,CAACC,IAAI,CAACF,SAAS,EAAG,IAAG,CAAC;EAE1C,MAAMuB,EAAE,CAACC,SAAS,CAACF,OAAO,CAAC;EAC3B,MAAMC,EAAE,CAACE,QAAQ,CAACH,OAAO,CAAC;EAE1B,MAAMI,eAAqC,GAAG,EAAE;EAChD,KAAK,MAAMP,IAAI,IAAIT,mBAAmB,EAAE;IACtC,MAAMiB,UAAU,GAAG1B,IAAI,CAACC,IAAI,CAACmB,SAAS,EAAG,GAAEF,IAAK,OAAM,CAAC;IACvD,MAAMS,QAAQ,GAAG3B,IAAI,CAACC,IAAI,CAACoB,OAAO,EAAG,GAAEH,IAAK,OAAM,CAAC;IAEnDO,eAAe,CAACG,IAAI,CAACN,EAAE,CAACO,IAAI,CAACH,UAAU,EAAEC,QAAQ,CAAC,CAAC;EACrD;EAEA,MAAMG,OAAO,CAACC,GAAG,CAACN,eAAe,CAAC;AACpC;AAEO,eAAeO,mBAAmB,CAAC;EACxCC,OAAO;EACP1B,UAAU;EACVC,uBAAuB;EACvB0B,sBAAsB;EACtBC,QAAQ;EACRC,SAAS,GAAG;AAQd,CAAC,EAA4C;EAAA;EAC3C,MAAMC,KAAK,GAAGC,YAAK,CAACC,QAAQ,EAAE;EAC9B,MAAMC,UAAU,GAAGH,KAAK,CAACI,OAAO,CAACC,WAAW,4BACxCL,KAAK,CAACM,MAAM,CAACH,UAAU,yEAAK,EAAC,GAC5B,EAAC;EACN,MAAMI,iBAAiB,GAAG,CAAC,CAAC;EAC5B,KAAK,MAAM,CAACC,GAAG,EAAEC,KAAK,CAAC,IAAIT,KAAK,CAACU,MAAM,EAAE;IACvCH,iBAAiB,CAACC,GAAG,CAAC,GAAGC,KAAK;EAChC;EAEA,MAAME,2BAA2B,GAAG,CAAC,CAAC;EACtC,KAAK,MAAM,CAACC,QAAQ,EAAEC,OAAO,CAAC,IAAIb,KAAK,CAACc,gBAAgB,EAAE;IACxD,MAAMC,aAAa,GAAG,CAAC,CAAC;IACxB,KAAK,MAAMpD,IAAI,IAAIqD,MAAM,CAACC,IAAI,CAACJ,OAAO,CAAC,EAAE;MACvCE,aAAa,CAACpD,IAAI,CAAC,GAAGkD,OAAO,CAAClD,IAAI,CAAC;IACrC;IAEAgD,2BAA2B,CAACC,QAAQ,CAAC,GAAGG,aAAa;EACvD;EAEA,MAAMG,YAAY,GAAG,MAAM,IAAAC,yCAAgB,EAACxD,IAAI,CAACC,IAAI,CAACgC,OAAO,EAAG,QAAO,CAAC,CAAC;EAEzE,MAAMwB,QAA0C,GAAG,CAAC,CAAC;EACrD,KAAK,MAAMC,YAAY,IAAInD,UAAU,CAACK,MAAM,EAAE,EAAE;IAC9C,MAAMI,iBAAiB,GACrBR,uBAAuB,CAACS,GAAG,CAACyC,YAAY,CAAC3C,aAAa,CAAC,IAAI,EAAE;IAE/D0C,QAAQ,CAACC,YAAY,CAACC,kBAAkB,CAAC,GAAG;MAC1CC,KAAK,EAAEF,YAAY,CAACE,KAAK;MACzB5C,iBAAiB;MACjB6C,MAAM,EAAE,MAAM,IAAAC,uDAA8B,EAC1CJ,YAAY,CAACC,kBAAkB,EAC/BJ,YAAY;IAEhB,CAAC;EACH;EAEA,MAAMQ,aAA0C,GAAG,EAAE;EACrD,KAAK,MAAM,CAACC,QAAQ,EAAEC,IAAI,CAAC,IAAI5B,KAAK,CAAC6B,KAAK,EAAE;IAC1C,MAAMC,IAAI,GAAG,IAAAC,qBAAW,EAACH,IAAI,EAAE5B,KAAK,CAAC;IACrC,IAAI8B,IAAI,KAAM,KAAI,EAAE;MAClBJ,aAAa,CAACnC,IAAI,CAAC,CACjBoC,QAAQ,EACR;QACEL,kBAAkB,EAAEM,IAAI,CAACN,kBAAkB;QAC3C5C,aAAa,EAAEkD,IAAI,CAAClD,aAAa;QACjCsD,OAAO,EAAEJ,IAAI,CAACI,OAAO;QACrBC,SAAS,EAAEL,IAAI,CAACK,SAAS;QACzBH,IAAI;QACJnE,IAAI,EAAEiE,IAAI,CAACjE,IAAI;QACf+C,MAAM,EAAEkB,IAAI,CAAClB;MACf,CAAC,CACF,CAAC;IACJ;EACF;EAEA,MAAMwB,QAAQ,GAAG,IAAAC,gBAAO,EAAC;IACvBC,IAAI,EAAG,aAAY;IACnBN,IAAI,EAAG,MAAK;IACZO,KAAK,EAAE1E,IAAI,CAACC,IAAI,CAAC0E,SAAS,EAAG,UAAS,CAAC;IACvCC,MAAM,EAAE;MACN5E,IAAI,EAAED,SAAS;MACf8E,QAAQ,EAAG,UAAS;MACpBC,aAAa,EAAG;IAClB,CAAC;IACDC,MAAM,EAAG,MAAK;IACdC,gBAAgB,EAAE;MAChBC,IAAI,EAAE;IACR,CAAC;IACDC,KAAK,EAAE;MACLC,IAAI,EAAG,YAAW;MAClBV,IAAI,EAAG,UAAS;MAChBrE,aAAa;MACbgF,iBAAiB,EAAE;QACjBzC,MAAM,EAAE,CAAC0C,UAAU;MACrB;IACF,CAAC;IACD;IACAC,SAAS,EAAE,CACT,aAAa,EACZ,UAAS;IAAE;IACZC,eAAG,CAACC,cAAc,CAACC,MAAM,CAAC,CAACC,GAAG,EAAEC,aAAa,KAAK;MAChD,IAAIA,aAAa,KAAM,IAAG,EAAE;QAC1BD,GAAG,CAACC,aAAa,CAAC,GAAI,yBAAwB;MAChD,CAAC,MAAM;QACLD,GAAG,CAACC,aAAa,CAAC,GAAI,YAAWA,aAAc,EAAC;MAClD;MAEA,OAAOD,GAAG;IACZ,CAAC,EAAE,CAAC,CAAC,CAAC,CACP;IACDE,OAAO,EAAE,KAAK;IACdC,MAAM,EAAE;MACNC,KAAK,EAAE,CACL;QACEC,IAAI,EAAE,SAAS;QACfZ,IAAI,EAAG,iBAAgB;QACvBa,OAAO,EAAE;UACPC,YAAY,EAAE;YACZC,GAAG,EAAE;cACHC,cAAc,EAAE;YAClB;UACF;QACF;MACF,CAAC,EACD;QACE;QACAJ,IAAI,EAAE,gBAAgB;QACtB;QACAK,MAAM,EAAE;UAAEC,GAAG,EAAE;QAAM,CAAC;QACtBC,GAAG,EAAE;UACHC,MAAM,EAAEC,OAAO,CAACR,OAAO,CAAE,wCAAuC,CAAC;UACjES,OAAO,EAAE;YACPC,eAAe,EAAG;UACpB;QACF;MACF,CAAC,EACD;QACEX,IAAI,EAAE,OAAO;QACbZ,IAAI,EAAG;MACT,CAAC;IAEL,CAAC;IACDa,OAAO,EAAE;MACPlG,UAAU;MACV6G,KAAK,EAAE;QACL,QAAQ,EAAG,GAAE1E,OAAQ,UAAS;QAC9B,CAACuE,OAAO,CAACR,OAAO,CAAE,8CAA6C,CAAC,GAC9D,KAAK;QACPY,QAAQ,EAAE;MACZ;IACF,CAAC;IACDC,OAAO,EAAE,CACP,IAAIrC,gBAAO,CAACsC,YAAY,CAAC;MACvBC,2BAA2B,EAAEC,IAAI,CAACC,SAAS,CAACxD,QAAQ,CAAC;MACrDyD,sBAAsB,EAAEF,IAAI,CAACC,SAAS,CAAC5E,KAAK,CAACM,MAAM,CAACwE,OAAO,CAAC;MAC5DC,wBAAwB,EAAEJ,IAAI,CAACC,SAAS,CAAC/E,sBAAsB,CAAC;MAChEmF,YAAY,EAAEL,IAAI,CAACC,SAAS,CAAClD,aAAa,CAAC;MAC3CuD,aAAa,EAAEN,IAAI,CAACC,SAAS,CAACrE,iBAAiB,CAAC;MAChD2E,yBAAyB,EAAEP,IAAI,CAACC,SAAS,CAACjE,2BAA2B,CAAC;MACtEwE,oBAAoB,EAAER,IAAI,CAACC,SAAS,CAClC,QAA2B,GAAE,IAAI/G,OAAO,CAACuH,GAAG,CAACH,aAAa,GACtDhG,EAAE,CAACoG,YAAY,CACb1H,IAAI,CAACC,IAAI,CACPgC,OAAO,EACN,QAAO,EACP,SAAQ,EACR,QAAO,EACP,wBAAuB,CACzB,EACA,OAAM,CACR,GACA,EAAC,CACP;MACD0F,WAAW,EAAEX,IAAI,CAACC,SAAS,CAACzE,UAAU,CAAC;MACvC;MACA,2BAA2B,EAAEwE,IAAI,CAACC,SAAS,CAAE,WAAU,CAAC;MACxD;MACA,2BAA2B,EAAED,IAAI,CAACC,SAAS,CACzC,CAAC,CAAC/G,OAAO,CAACuH,GAAG,CAACH,aAAa;IAE/B,CAAC,CAAC,EACF,yBAAApH,OAAO,CAACuH,GAAG,CAACG,sBAAsB,kDAAlC,sBAAoCC,QAAQ,CAAE,aAAY,CAAC,GACvD,IAAIC,oCAAoB,CAAC7F,OAAO,EAAEE,QAAQ,EAAEC,SAAS,CAAC,GACtD,KAAK,CACV,CAAC2F,MAAM,CAACC,OAAO;EAClB,CAAC,CAAC;EAEF,IAAIC,4CAA4C,GAAI,EAAC;EACrD,wBAAIC,MAAM,CAACC,QAAQ,6CAAf,iBAAiBC,8BAA8B,EAAE;IACnD,MAAM9G,EAAE,CAAC+G,QAAQ,CACfH,MAAM,CAACC,QAAQ,CAACC,8BAA8B,EAC9CpI,IAAI,CAACC,IAAI,CAACF,SAAS,EAAG,4BAA2B,CAAC,CACnD;IACDkI,4CAA4C,GAAI,8BAA6B;EAC/E;EAEA,IAAIK,2CAA2C,GAAI,EAAC;EACpD,yBAAIJ,MAAM,CAACC,QAAQ,8CAAf,kBAAiBI,6BAA6B,EAAE;IAClD,MAAMjH,EAAE,CAAC+G,QAAQ,CACfH,MAAM,CAACC,QAAQ,CAACI,6BAA6B,EAC7CvI,IAAI,CAACC,IAAI,CAACF,SAAS,EAAG,2BAA0B,CAAC,CAClD;IACDuI,2CAA2C,GAAI,6BAA4B;EAC7E;EAEA,IAAIE,YAAY,GAAG,MAAMlH,EAAE,CAACmH,QAAQ,CAClCzI,IAAI,CAACC,IAAI,CAAC0E,SAAS,EAAG,WAAU,CAAC,EAChC,OAAM,CACR;EAED6D,YAAY,GAAGA,YAAY,CACxBE,UAAU,CACR,sBAAqB,EACtB,IAAAC,qCAAqB,GAAE,GAAI,EAAC,GAAG,IAAAC,gCAAgB,GAAE,CAClD,CACAF,UAAU,CACR,wBAAuB,EACxB,IAAAC,qCAAqB,GAAE,GAAI,EAAC,4BAAGtG,KAAK,CAACwG,OAAO,CAAClG,MAAM,CAACmG,SAAS,yEAAK,EAAC,CACpE,CACAJ,UAAU,CAAE,eAAc,EAAElG,UAAU,CAAC,CACvCkG,UAAU,CACR,gDAA+C,EAChDT,4CAA4C,CAC7C,CACAS,UAAU,CACR,+CAA8C,EAC/CJ,2CAA2C,CAC5C;EAEH,MAAMhH,EAAE,CAACyH,UAAU,CAAC/I,IAAI,CAACC,IAAI,CAACF,SAAS,EAAG,WAAU,CAAC,EAAEyI,YAAY,CAAC;EAEpE,OAAO,IAAI1G,OAAO,CAAC,CAACkE,OAAO,EAAEgD,MAAM,KAAK;IACtCzE,QAAQ,CAAC0E,GAAG,CAAC,CAACC,GAAG,EAAEC,KAAK,KAAK;MAC3B5E,QAAQ,CAAC6E,KAAK,CAACC,QAAQ,IAAI;QACzB,IAAIH,GAAG,EAAE;UACP,OAAOF,MAAM,CAACE,GAAG,CAAC;QACpB;QACA,IAAIG,QAAQ,EAAE;UACZ,OAAOL,MAAM,CAACK,QAAQ,CAAC;QACzB;QACA,OAAOrD,OAAO,CAACmD,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEG,WAAW,CAAC;MACpC,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ"}